generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PriceType {
  FIXED
  FROM
  RANGE
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  RESCHEDULED
}

model ServiceCategory {
  id        String    @id @default(uuid())
  name      String
  slug      String    @unique
  sortOrder Int       @default(0)
  services  Service[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Service {
  id          String        @id @default(uuid())
  categoryId  String
  category    ServiceCategory @relation(fields: [categoryId], references: [id])
  name        String
  slug        String        @unique
  description String?
  durationMin Int
  bufferMin   Int           @default(10)
  priceType   PriceType
  priceFrom   Int?
  priceTo     Int?
  isFeatured  Boolean       @default(false)
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  bookings    Booking[]

  @@index([categoryId])
}

model StaffMember {
  id        String    @id @default(uuid())
  name      String
  isActive  Boolean   @default(true)
  bookings  Booking[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([name])
}

model BusinessSettings {
  id               Int      @id @default(1)
  timezone         String   @default("Europe/Rome")
  leadTimeMin      Int      @default(120)
  cancelLimitHours Int      @default(24)
  defaultBufferMin Int      @default(10)
  lunchEnabled     Boolean  @default(false)
  lunchStart       String?
  lunchEnd         String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model WeeklySchedule {
  id         String   @id @default(uuid())
  dayOfWeek  Int
  openTime   String?
  closeTime  String?
  isClosed   Boolean  @default(false)
  lunchStart String?
  lunchEnd   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([dayOfWeek])
}

model Closure {
  id        String   @id @default(uuid())
  startAt   DateTime @db.Timestamptz(6)
  endAt     DateTime @db.Timestamptz(6)
  reason    String?
  createdAt DateTime @default(now())
}

model Customer {
  id        String    @id @default(uuid())
  fullName  String
  phone     String
  email     String?
  createdAt DateTime  @default(now())
  bookings  Booking[]
}

model Booking {
  id          String         @id @default(uuid())
  serviceId   String
  staffId     String
  customerId  String
  startAt     DateTime       @db.Timestamptz(6)
  endAt       DateTime       @db.Timestamptz(6)
  status      BookingStatus  @default(CONFIRMED)
  notes       String?
  cancelToken String         @unique
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  service Service   @relation(fields: [serviceId], references: [id])
  staff   StaffMember @relation(fields: [staffId], references: [id])
  customer Customer @relation(fields: [customerId], references: [id])

  @@index([serviceId])
  @@index([staffId, startAt])
}
